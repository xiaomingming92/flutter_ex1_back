generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  username  String?   @unique
  phone     String?   @unique
  password  String
  name      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  articles  Article[]

  @@map("users")
}

model Article {
  id            String         @id @default(uuid())
  title         String
  content       String         @db.Text
  authorId      String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  author        User           @relation(fields: [authorId], references: [id], onDelete: Cascade)
  waterfallItem WaterfallItem?
  media         ArticleMedia[]

  @@index([authorId], map: "articles_authorId_fkey")
  @@map("articles")
}

model Image {
  id             String          @id @default(uuid())
  url            String
  width          Int?
  height         Int?
  filename       String?
  mimeType       String?
  size           Int?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  waterfallItems WaterfallItem[]
  articleMedia   ArticleMedia[]

  @@map("images")
}

model WaterfallItem {
  id          String   @id @default(uuid())
  description String?  @db.Text
  articleId   String   @unique
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  imageId     String?
  article     Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  image       Image?   @relation(fields: [imageId], references: [id])

  @@index([sortOrder, createdAt])
  @@index([imageId], map: "waterfall_items_imageId_fkey")
  @@map("waterfall_items")
}

model ArticleMedia {
  id        String   @id @default(uuid())
  articleId String
  imageId   String
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  image     Image    @relation(fields: [imageId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([imageId])
  @@map("article_media")
}

model UserToken {
  id               String    @id @default(uuid())
  userId           String
  accessToken      String    @db.VarChar(255)
  refreshToken     String    @unique @db.VarChar(255)
  accessExpiresAt  DateTime
  refreshExpiresAt DateTime
  createdAt        DateTime  @default(now())
  revokedAt        DateTime?

  @@index([userId])
  @@index([accessToken])
  @@map("user_tokens")
}
