<!--
 * @Author       : Z2-WIN\xmm wujixmm@gmail.com
 * @Date         : 2025-12-26 09:56:04
 * @LastEditors  : Z2-WIN\xmm wujixmm@gmail.com
 * @LastEditTime : 2025-12-26 13:48:02
 * @FilePath     : \ex1c:\Users\xmm\studioProjects\flutter_ex1_back\docs\信息脱敏和敏感信息查看审计文档.md
 * @Description  :
-->

# 信息脱敏和敏感信息查看审计文档

## ��� 概述

本文档描述了后端系统中信息脱敏处理和敏感信息查看审计机制的设计与实现，确保用户隐私保护和数据安全合规。

## ��� 信息脱敏策略

### 1. 脱敏数据分类

#### 1.1 一级敏感信息（严格脱敏）

- **手机号码**: `138****5678` (保留前3位和后4位，中间4位用\*替换)
- **身份证号码**: `11010119900101****` (保留前6位和后4位)
- **银行卡号**: `6222 **** **** 1234` (保留前4位和后4位)

#### 1.2 二级敏感信息（条件脱敏）

- **邮箱地址**: `user***@domain.com` (用户名部分脱敏)
- **真实姓名**: 在非必要场景下使用昵称代替

### 2. 脱敏实现方案

#### 2.1 手机号脱敏服务

```typescript
// 在 src/utils/dataMasking.ts 中实现
export function maskPhoneNumber(phone: string): string {
  if (!phone || phone.length < 8) {
    return '';
  }

  // 匹配手机号：1[3-9]\d{9}
  const phoneRegex = /^1[3-9]\d{9}$/;
  if (!phoneRegex.test(phone)) {
    return '';
  }

  return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
}

export function maskIdCard(idCard: string): string {
  if (!idCard || idCard.length < 10) {
    return '';
  }

  return idCard.replace(/(\d{6})\d{8}(\d{4})/, '$1********$2');
}

export function maskBankCard(cardNumber: string): string {
  if (!cardNumber || cardNumber.length < 8) {
    return '';
  }

  return cardNumber.replace(/(\d{4})\d{8,12}(\d{4})/, '$1 **** **** $2');
}
```

## ��� 敏感信息查看审计

### 1. 审计数据表结构

#### 1.1 敏感信息查看记录表

```sql
-- 在数据库迁移文件中创建
CREATE TABLE sensitive_data_access_log (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id VARCHAR(50) NOT NULL COMMENT '查看者用户ID',
  target_user_id VARCHAR(50) NOT NULL COMMENT '被查看用户ID',
  data_type ENUM('phone', 'id_card', 'bank_card', 'real_name') NOT NULL COMMENT '敏感数据类型',
  access_reason VARCHAR(200) NOT NULL COMMENT '查看原因',
  ip_address VARCHAR(45) NOT NULL COMMENT 'IP地址',
  user_agent TEXT COMMENT '用户代理',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '访问时间',
  INDEX idx_user_id (user_id),
  INDEX idx_target_user_id (target_user_id),
  INDEX idx_data_type (data_type),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='敏感信息查看审计日志';
```

## ���️ 安全措施

### 1. 访问控制

- JWT Token验证
- 角色权限检查（admin/user）
- 敏感操作二次确认

### 2. 数据传输安全

- HTTPS加密传输
- API请求频率限制
- 敏感数据脱敏响应

### 3. 审计合规

- 所有敏感信息访问完整记录
- 定期审计日志分析
- 异常访问行为监控告警

此文档确保了信息脱敏和敏感信息查看的完整性和合规性，为系统安全提供了坚实的保障。
